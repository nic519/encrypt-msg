<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>文本加密工具</title>
    <link rel="stylesheet" href="css/main.css">
    <!-- Alpine.js 本地文件 -->
    <script defer src="lib/alpine.min.js"></script>
</head>
<body>
    <div class="container" x-data="encryptApp">
        <div class="wechat-warning" id="wechatWarning" x-show="isWechat">
            ⚠️ 检测到微信访问，请使用浏览器打开本页面
        </div>

        <div class="chat-container" id="mainContent" x-show="!isWechat">
            <div class="messages-container" id="messages-area">
                <!-- 标题消息 -->
                <div class="title-bubble">
                    <div class="title-content">
                        <h1>🔐 文本加密工具</h1>
                    </div>
                </div>
                
                <!-- 消息列表 - 使用优化后的过滤方法 -->
                <template x-for="message in getValidMessages()" :key="message.id">
                    <div class="message-bubble" 
                         :class="message.type === 'right' ? 'right-bubble' : 'left-bubble'">
                        
                        <!-- 统一的内容循环 - 消除重复 -->
                        <template x-for="(contentItem, index) in message.content" :key="index">
                            <div x-if="contentItem && contentItem.text && contentItem.label" 
                                 class="message" 
                                 :class="{'encrypt-message': contentItem.type === 'encrypted'}">
                                <div class="message-header">
                                    <div class="message-label">
                                        <span x-text="contentItem.label"></span>
                                        <!-- 只在第一个内容项显示时间 -->
                                        <span x-show="index === 0" class="message-time" x-text="message.time"></span>
                                    </div>
                                    <button class="message-copy-btn" @click="copyMessageContent(contentItem.text, $event)">
                                        <span class="copy-icon"></span>
                                        <span>复制</span>
                                    </button>
                                </div>
                                <div class="message-content" 
                                     :class="{'encrypted-content': contentItem.type === 'encrypted'}" 
                                     x-html="contentItem.type === 'encrypted' ? contentItem.text : contentItem.text.replace(/\n/g, '<br>').replace(/\t/g, '&nbsp;&nbsp;&nbsp;&nbsp;').replace(/ {2}/g, '&nbsp;&nbsp;')">
                                </div>
                            </div>
                        </template>
                        
                    </div>
                </template>
            </div>
        </div>
        
        <div class="input-area" x-show="!isWechat">
            <div class="textarea-container">
                <textarea id="message-input" placeholder="输入要加密的文本..." x-model="inputText" @keydown.enter.prevent="!$event.shiftKey && processMessage()"></textarea>
                <button class="clear-btn" @click="clearText()" title="清空文本" x-show="inputText">✖️</button>
            </div>
            <div class="input-actions">
                <button class="help-btn" @click="toggleTips" title="显示/隐藏帮助信息">❓</button>
                <div class="main-actions">
                    <button class="action-btn decrypt-btn" @click="pasteAndDecrypt">
                        <span class="btn-icon">🔓</span>
                        <span class="btn-text">解密</span>
                    </button>
                    <button class="action-btn encrypt-btn" @click="processMessage" :disabled="!inputText">
                        <span class="btn-icon">🔒</span>
                        <span class="btn-text">加密</span>
                    </button>
                </div>
            </div>
        </div>

        <div class="tips" id="tipsContainer" x-show="showTips" x-transition>
            <div class="tips-header">
                <h3>使用帮助</h3>
                <button class="close-tips-btn" @click="toggleTips">✖️</button>
            </div>
            <ul>
                <li><span class="emoji">🛡️</span> 本工具完全在浏览器中运行，不会上传任何数据</li>
                <li><span class="emoji">🔄</span> 每次加密结果都不同，增强安全性</li>
            </ul>
        </div>
        
        <!-- 复制成功提示 -->
        <div class="copy-success" :class="{'show': showCopySuccess}" x-text="copySuccessText"></div>
    </div>

    <!-- 模块化JavaScript文件 -->
    <script src="js/crypto-service.js"></script>
    <script src="js/message-service.js"></script>
    <script src="js/ui-service.js"></script>
    <script src="js/app.js"></script>
</body>
</html> 